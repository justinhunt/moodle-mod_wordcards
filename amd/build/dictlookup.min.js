define(["jquery","core/log","core/ajax","core/templates"],(function($,log,ajax,templates){return log.debug("Wordcards dictionary lookup: initialising"),{init:function(cmid,modid,resultscont){log.debug("Wordcards dictionary lookup: initialising"),this.cmid=cmid,this.modid=modid,this.resultscont=resultscont},update_page:function(alldata){var that=this;that.resultscont.empty();for(var i=0;i<alldata.length;i++){var tdata=alldata[i];templates.render("mod_wordcards/word_wizard_oneresult",tdata).then((function(html,js){that.resultscont.append(html),templates.runTemplateJS(js)}))}},getwords:function(allwords,sourcelang,definitionslang){var that=this;if(""===allwords.trim())return!1;for(var requests=[],wordarray=allwords.split(","),i=0;i<wordarray.length;i++){var word=wordarray[i].trim();""!==word&&requests.push({methodname:"mod_wordcards_search_dictionary",args:{terms:word,cmid:that.cmid,sourcelang:sourcelang,targetlangs:definitionslang},async:!1})}var wordpromises=ajax.call(requests);Promise.all(wordpromises).then((async function(allresponses){var allterms_result=[];if(0===allresponses.length)return allterms_result;for(var responseindex=0;responseindex<allresponses.length;responseindex++){var response=allresponses[responseindex];0===response.success&&log.debug(response.payload);for(var terms=JSON.parse(response.payload),i=0;i<terms.length;i++){var theterm=terms[i];if(0===theterm.count){var senses=[];senses.push({definition:"",sourcedefinition:"No def. available",modelsentence:"",senseindex:0,translations:"{}"});var tdata={term:theterm.term,senses:senses,modid:that.modid};allterms_result.push(tdata)}else{tdata={term:theterm.term,senses:[],modid:that.modid};for(var sindex in theterm.results){var sense=theterm.results[sindex],sourcedefinition=sense.definition,alltrans={};for(var langkey in sense)sense.hasOwnProperty(langkey)&&langkey.startsWith("lang_")&&(alltrans[langkey.substring(5)]=sense[langkey]);var translations=JSON.stringify(alltrans),definition=sourcedefinition;"en"!==definitionslang&&(definition=sense.hasOwnProperty("lang_"+definitionslang)?sense["lang_"+definitionslang]:"en"===definitionslang?sense.meaning:"No translation available");var modelsentence=sense.example;tdata.senses.push({definition:definition,sourcedefinition:sourcedefinition,modelsentence:modelsentence,senseindex:sindex,translations:translations})}allterms_result.push(tdata)}}}that.update_page(allterms_result)}))}}}));

//# sourceMappingURL=dictlookup.min.js.map