define ("mod_wordcards/definitions",["jquery","core/ajax","core/notification","core/modal_factory","core/str","core/modal_events","mod_wordcards/a4e"],function(a,b,c,d,e,g,h){"use strict";return{strings:{},init:function init(e){var m=this;this.init_strings();var n="#"+e.widgetid,o=a(n).get(0);if(o){var p=JSON.parse(o.value);this.props=p;a(n).remove()}else{log.debug("No config found on page. Giving up.");return}var q=a(".event_flashcards"),i=a(".event_grid");a(".ProgressBar-step").on("click",function(){if(a(this).hasClass("is-current")){return!1}a(".ProgressBar-step").removeClass("is-current").removeClass("is-complete");a(this).addClass("is-current");var b=a(this).index();if(0<b){for(var c=0;c<=b;c++){a(".ProgressBar").find("li:eq("+c+")").addClass("is-complete")}}a(".definition_flashcards_ul li").slideUp(300);a(".definition_flashcards_ul").find("li:eq("+b+")").slideDown(300);a(".is-current").removeClass("is-complete");j();k()});if(window.matchMedia("(max-width: 767px)").matches){var r=a(".definition_flashcards_ul li").length;a(".wrapper_pr").append("<div class=\"mb_nav\"><span class=\"curr_level_card\">1</span> / <span class=\"tot_level_card\">"+r+"</span></div>");a(".ProgressBar").hide()}a(".definition_flashcards_ul li:gt(0)").hide();var s=a(".ProgressBar");s.children("li:first").addClass("is-current");j();k();q.click(function(b){b.preventDefault();a(".definition_flashcards").show();a(".definition_grid").hide()});i.click(function(b){b.preventDefault();a(".definition_flashcards").hide();a(".definition_grid").show()});function j(){var b=a(".ProgressBar");if(!0===b.children("li:first").hasClass("is-current")){a("#Prev").attr("disabled","disabled").addClass("add_opacity_level");return!0}a("#Prev").removeAttr("disabled");a("#Prev").removeAttr("disabled").removeClass("add_opacity_level")}a("#Next").click(function(){var b=a(".is-current").index()+1;a(".definition_flashcards_ul li").slideUp(300);a(".definition_flashcards_ul li:eq("+b+")").slideDown(300);var c=a(".curr_level_card").html();a(".curr_level_card").html(parseInt(c)+1);var d=a(".ProgressBar");if(0<d.children(".is-current").length){d.children(".is-current").removeClass("is-current").addClass("is-complete").next().addClass("is-current")}else{d.children().first().addClass("is-current")}j();k()});a("#Prev").click(function(){var b=a(".is-current").index()-1;a(".definition_flashcards_ul li").slideUp(300);a(".definition_flashcards_ul li:eq("+b+")").slideDown(300);var c=a(".curr_level_card").html();a(".curr_level_card").html(parseInt(c)-1);var d=a(".ProgressBar");if(0<d.children(".is-current").length){d.children(".is-current").removeClass("is-current").prev().removeClass("is-complete").addClass("is-current")}else{d.children(".is-complete").last().removeClass("is-complete").addClass("is-current")}j();k()});function k(){var b=a(".ProgressBar");if(!0===b.children("li:last").hasClass("is-current")){a("#Next").attr("disabled","disabled").addClass("add_opacity_level");return!0}a("#Next").removeAttr("disabled").removeClass("add_opacity_level")}var t=a("#definitions-page-"+e.widgetid),u=p.modid,v=p.canmanage,w=p.canattempt,x=t.find(".definitions-next");h.register_events();h.init_audio(p.token,p.region,p.owner);function l(){return t.find(".term").length===t.find(".term.term-seen").length}t.on("click",".term-seen-action",function(d){d.preventDefault();var e=a(this).parents(".term").first(),g=e.data("termid");e.addClass("term-loading");b.call([{methodname:"mod_wordcards_mark_as_seen",args:{termid:g}}])[0].then(function(b){if(!b){return a.Deferred().reject()}a(".definition_flashcards [data-termid=\""+f+"\"]").addClass("term-seen");a(".definition_grid [data-termid=\""+f+"\"]").addClass("term-seen")}).fail(c.exception).always(function(){e.removeClass("term-loading");if(l()){x.prop("disabled",!1)}})});if(!l()&&!v){x.prop("disabled",!0)}x.click(function(b){b.preventDefault();var c=a(this).data("href");if("reattempt"!==a(this).data("action")){window.location.href=c;return}d.create({type:d.types.SAVE_CANCEL,title:m.strings.reattempttitle,body:m.strings.reattemptbody}).then(function(a){a.setSaveButtonText(m.strings.reattempt);var b=a.getRoot();b.on(g.save,function(){window.location.href=c});a.show()})})},init_strings:function init_strings(){var a=this;e.get_strings([{key:"reattempttitle",component:"mod_wordcards"},{key:"reattemptbody",component:"mod_wordcards"},{key:"reattempt",component:"mod_wordcards"}]).done(function(b){var c=0;a.strings.reattempttitle=b[c++];a.strings.reattemptbody=b[c++];a.strings.reattempt=b[c++]})}}});
//# sourceMappingURL=definitions.min.js.map
