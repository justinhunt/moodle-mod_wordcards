{"version":3,"file":"bulkimagegen.min.js","sources":["../src/bulkimagegen.js"],"sourcesContent":["define(['jquery', 'core/log', 'core/ajax', 'core/str'], function ($, log, ajax, str) {\r\n    \"use strict\"; // jshint ;_;\r\n    /*\r\n    This file does bulk image generation for wordcards\r\n     */\r\n\r\n    log.debug('Bulk Image Generator: initialising');\r\n\r\n    return {\r\n        cmid:  false,\r\n        strings: {},\r\n\r\n        init: function(cmid){\r\n            this.cmid = cmid;\r\n            this.init_strings();\r\n            this.register_events();\r\n            log.debug('Bulk Image Generator: initialised');\r\n        },\r\n\r\n        init_strings: function() {\r\n            var self = this;\r\n             // Set up strings\r\n            str.get_strings([\r\n                    { \"key\": \"noimagesgenerated\", \"component\": \"mod_wordcards\" },\r\n                    { \"key\": \"generatingimages\", \"component\": \"mod_wordcards\" },\r\n                    { \"key\": \"imagesgenerated\", \"component\": \"mod_wordcards\" }\r\n                ]).done(function (s) {\r\n                    var i = 0;\r\n                    self.strings.noimagesgenerated = s[i++];\r\n                    self.strings.generatingimages = s[i++];\r\n                    self.strings.imagesgenerated = s[i++];\r\n                });\r\n        },\r\n\r\n        register_events: function(){\r\n            log.debug('registering events');\r\n            var self = this;\r\n            var bulkbtn = $('.ww_words_fetch_image_btn');\r\n            var resultscont = $('.mod_wordcards_ww_image_results');\r\n        \r\n            bulkbtn.on('click', function(e){\r\n                log.debug('bulkbtn clicked');\r\n                resultscont.empty();\r\n                resultscont.append('<div>' + self.strings.generatingimages + '</div><i class=\"fa fa-spinner fa-spin fa-3x\"></i>');\r\n                resultscont.show();\r\n\r\n                //Disable the button to prevent multiple clicks\r\n                bulkbtn.prop('disabled', true);\r\n\r\n                //Call the ajax method to generate images\r\n                log.debug('Calling ajax to generate images');\r\n                ajax.call([{\r\n                        methodname: 'mod_wordcards_generate_bulk_images',\r\n                        args: {\r\n                            cmid: self.cmid\r\n                        }\r\n                    }])[0].then(function(result) {\r\n                        log.debug(result);\r\n                        resultscont.empty();\r\n                        if(result.images && result.images.length > 0) {\r\n                            resultscont.append('<div>' + result.images.length + ' ' + self.strings.imagesgenerated + '</div>');\r\n                            for (var i = 0; i < result.images.length; i++) {\r\n                                var image = result.images[i];\r\n                                var img = $('<img>', {\r\n                                    src: image.url,\r\n                                    class: 'ww_bulk_image_thumb'\r\n                                });\r\n                                resultscont.append(img);\r\n                            }\r\n                        } else {\r\n                            resultscont.append('<div class=\"alert alert-info\">' + self.strings.noimagesgenerated + '</div>');\r\n                        }\r\n                        // Re enable the button after the operation is complete\r\n                        bulkbtn.prop('disabled', false);\r\n                    \r\n                }).catch(function(ex) {\r\n                    log.error('Error generating images: ', ex);\r\n                    resultscont.empty();\r\n                    resultscont.append('<div class=\"alert alert-danger\">' + (ex.message || ex) + '</div>');\r\n                    // Re enable the button after the operation is complete\r\n                    bulkbtn.prop('disabled', false);\r\n                });\r\n            });\r\n        },\r\n    };//end of return value\r\n});"],"names":["define","$","log","ajax","str","debug","cmid","strings","init","init_strings","register_events","self","this","get_strings","done","s","i","noimagesgenerated","generatingimages","imagesgenerated","bulkbtn","resultscont","on","e","empty","append","show","prop","call","methodname","args","then","result","images","length","image","img","src","url","class","catch","ex","error","message"],"mappings":"AAAAA,oCAAO,CAAC,SAAU,WAAY,YAAa,aAAa,SAAUC,EAAGC,IAAKC,KAAMC,YAM5EF,IAAIG,MAAM,sCAEH,CACHC,MAAO,EACPC,QAAS,GAETC,KAAM,SAASF,WACNA,KAAOA,UACPG,oBACAC,kBACLR,IAAIG,MAAM,sCAGdI,aAAc,eACNE,KAAOC,KAEXR,IAAIS,YAAY,CACR,KAAS,8BAAkC,iBAC3C,KAAS,6BAAiC,iBAC1C,KAAS,4BAAgC,mBAC1CC,MAAK,SAAUC,OACVC,EAAI,EACRL,KAAKJ,QAAQU,kBAAoBF,EAAEC,KACnCL,KAAKJ,QAAQW,iBAAmBH,EAAEC,KAClCL,KAAKJ,QAAQY,gBAAkBJ,EAAEC,SAI7CN,gBAAiB,WACbR,IAAIG,MAAM,0BACNM,KAAOC,KACPQ,QAAUnB,EAAE,6BACZoB,YAAcpB,EAAE,mCAEpBmB,QAAQE,GAAG,SAAS,SAASC,GACzBrB,IAAIG,MAAM,mBACVgB,YAAYG,QACZH,YAAYI,OAAO,QAAUd,KAAKJ,QAAQW,iBAAmB,qDAC7DG,YAAYK,OAGZN,QAAQO,KAAK,YAAY,GAGzBzB,IAAIG,MAAM,mCACVF,KAAKyB,KAAK,CAAC,CACHC,WAAY,qCACZC,KAAM,CACFxB,KAAMK,KAAKL,SAEf,GAAGyB,MAAK,SAASC,WACjB9B,IAAIG,MAAM2B,QACVX,YAAYG,QACTQ,OAAOC,QAAUD,OAAOC,OAAOC,OAAS,EAAG,CAC1Cb,YAAYI,OAAO,QAAUO,OAAOC,OAAOC,OAAS,IAAMvB,KAAKJ,QAAQY,gBAAkB,cACpF,IAAIH,EAAI,EAAGA,EAAIgB,OAAOC,OAAOC,OAAQlB,IAAK,KACvCmB,MAAQH,OAAOC,OAAOjB,GACtBoB,IAAMnC,EAAE,QAAS,CACjBoC,IAAKF,MAAMG,IACXC,MAAO,wBAEXlB,YAAYI,OAAOW,WAGvBf,YAAYI,OAAO,iCAAmCd,KAAKJ,QAAQU,kBAAoB,UAG3FG,QAAQO,KAAK,YAAY,MAE9Ba,OAAM,SAASC,IACdvC,IAAIwC,MAAM,4BAA6BD,IACvCpB,YAAYG,QACZH,YAAYI,OAAO,oCAAsCgB,GAAGE,SAAWF,IAAM,UAE7ErB,QAAQO,KAAK,YAAY"}