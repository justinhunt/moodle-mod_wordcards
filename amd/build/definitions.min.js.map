{"version":3,"file":"definitions.min.js","sources":["../src/definitions.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification','core/modal_factory','core/str','core/modal_events', 'mod_wordcards/a4e'],\r\n    function($, Ajax, Notification,ModalFactory, str, ModalEvents, a4e) {\r\n  \"use strict\"; // jshint ;_;\r\n\r\n  return {\r\n\r\n    strings: {},\r\n\r\n    init: function(opts) {\r\n\r\n        var that = this;\r\n\r\n        //init strings\r\n        this.init_strings();\r\n\r\n        //pick up opts from html\r\n        var theid = '#' + opts['widgetid'];\r\n        var propscontrol = $(theid).get(0);\r\n        if (propscontrol) {\r\n            var props = JSON.parse(propscontrol.value);\r\n            this.props =props;\r\n            $(theid).remove();\r\n        } else {\r\n            //if there is no config we might as well give up\r\n            log.debug('No config found on page. Giving up.');\r\n            return;\r\n        }\r\n\r\n/* flashcards code start */\r\n\t\t\tvar ef = $(\".event_flashcards\");\r\n\t\t\tvar eg = $(\".event_grid\");\r\n\r\n\t\t\tvar totalcards = $('.definition_flashcards_ul li').length;\r\n\t\t\t$(\".definition_flashcards_ul li:gt(0)\").addClass('slide-is-hidden');\r\n            //set the first card as is_current\r\n            $(\".definition_flashcards_ul li:first\").addClass('is-current slide-is-visible');\r\n\t\t\tset_progress_info(1,totalcards);\r\n\r\n\t\t\t\r\n      /*\r\n      ef.click(function (d) {\r\n\t\t\t\td.preventDefault();\r\n\t\t\t\t$('.definition_flashcards').fadeIn();\r\n\t\t\t\t$('.definition_grid').fadeOut();\r\n\t\t\t\tef.addClass('btn-primary').removeClass('btn-outline-primary')\r\n\t\t\t\teg.removeClass('btn-primary').addClass('btn-outline-primary')\r\n\t\t\t});\r\n\t\t\teg.click(function (d) {\r\n\t\t\t\td.preventDefault();\r\n\t\t\t\t$('.definition_flashcards').fadeOut();\r\n\t\t\t\t$('.definition_grid').fadeIn();\r\n\t\t\t\teg.addClass('btn-primary').removeClass('btn-outline-primary')\r\n\t\t\t\tef.removeClass('btn-primary').addClass('btn-outline-primary')\r\n\t\t\t});\r\n      */\r\n\r\n\r\n\r\n\t\t\t$('#Next').click(function () {\r\n\t\t\t\tvar cr_index = $(\".is-current\").index() + 1;\r\n        if(cr_index > (totalcards-1)){cr_index=0;}\r\n        \r\n        $('.definition_flashcards_ul li').addClass(\"next-slide-is-leaving\"); \r\n        function afterLeaving() {\r\n          $('.definition_flashcards_ul li').removeClass(\"is-current next-slide-is-leaving slide-is-visible\").addClass(\"slide-is-hidden\");\r\n        }\r\n\r\n        $('.definition_flashcards_ul li:eq(' + cr_index + ')').removeClass(\"slide-is-hidden\").addClass(\"slide-is-visible next-slide-is-coming\");\t\t\t\r\n        function afterComing() {\r\n          $('.definition_flashcards_ul li:eq(' + cr_index + ')').removeClass(\"slide-is-hidden next-slide-is-coming\").addClass(\"slide-is-visible is-current\");\r\n        }\r\n\r\n        setTimeout(afterLeaving, 500);\r\n        setTimeout(afterComing, 500);\r\n\r\n\t\t\t\tset_progress_info(cr_index + 1,totalcards);\r\n\r\n        if (cr_index + 1 === totalcards) {\r\n          $('#Next').css({\"pointer-events\" : \"none\", \"opacity\" : \"0.5\"})\r\n        } else {\r\n          $('#Next').css({\"pointer-events\" : \"auto\", \"opacity\" : \"1\"})\r\n        }\r\n        \r\n\t\t\t});\r\n\r\n\t\t\t$('#Prev').click(function () {\r\n\t\t\t\tvar cr_index = $(\".is-current\").index() - 1;\r\n        if(cr_index <0){cr_index=(totalcards-1);}\r\n\t\t\t\t$('.definition_flashcards_ul li').addClass(\"prev-slide-is-leaving\"); \r\n        function afterLeaving() {\r\n          $('.definition_flashcards_ul li').removeClass(\"is-current prev-slide-is-leaving slide-is-visible\").addClass(\"slide-is-hidden\");\r\n        }\r\n         \r\n\t\t\t\t$('.definition_flashcards_ul li:eq(' + cr_index + ')').removeClass(\"slide-is-hidden\").addClass(\"slide-is-visible prev-slide-is-coming\");\t\t\t\r\n        function afterComing() {\r\n          $('.definition_flashcards_ul li:eq(' + cr_index + ')').removeClass(\"slide-is-hidden prev-slide-is-coming\").addClass(\"slide-is-visible is-current\");\r\n        }\r\n\r\n\t\t\t\tvar curr_level_card = $('.curr_level_card').html();\r\n\t\t\t\t$('.curr_level_card').html(parseInt(curr_level_card) - 1);\r\n\t\t\t\tset_progress_info(cr_index + 1 ,totalcards);\r\n\r\n        setTimeout(afterLeaving, 500);\r\n        setTimeout(afterComing, 500);\r\n\r\n\t\t\t});\r\n\r\n\r\n\r\n\t\t\tfunction set_progress_info(index,total) {\r\n\t\t\t\t$(\".definition_flashcards .wc_cardsprogress\").text(index + ' / ' + total);\r\n\t\t\t}\r\n\r\n\r\n\t\t\t/* flashcards code end */\r\n      var container = $('#definitions-page-' + opts['widgetid']),\r\n        modid = props.modid,\r\n        canmanage = props.canmanage,\r\n        canattempt = props.canattempt,\r\n        btn = container.find('.definitions-next');\r\n\r\n       //set up audio\r\n       a4e.register_events();\r\n       a4e.init_audio(props.token,props.region,props.owner);\r\n\r\n      container.on('click', '.term-seen-action', function(e) {\r\n        e.preventDefault();\r\n\r\n        var termNode = $(this).parents('.term').first();\r\n        var termId = termNode.data('termid');\r\n\r\n        //On the clicked (and visible) node add loading\r\n        termNode.addClass('term-loading');\r\n        Ajax.call([{\r\n            'methodname': 'mod_wordcards_mark_as_seen',\r\n            'args': {\r\n              'termid': termId\r\n            }\r\n          }])[0].then(function(result) {\r\n            if (!result) {\r\n              return $.Deferred().reject();\r\n            }\r\n\r\n          //since we have two nodes (grid and flashcards) for a single term,\r\n\t\t\t// and the user might toggle between the grid and flashcards view we need to update both\r\n\t\t\t//so the old termNode.addClass('term-seen') is no good. it would only update one\r\n          //  termNode.addClass('term-seen');\r\n\t\t\t$('.definition_flashcards [data-termid=\"' + termId + '\"]').addClass('term-seen')\r\n\t\t\t$('.definition_grid [data-termid=\"' + termId + '\"]').addClass('term-seen')\r\n          })\r\n          .fail(Notification.exception)\r\n          .always(function() {\r\n          \t//remove loading from  node which loading was applied to\r\n            termNode.removeClass('term-loading');\r\n\r\n          });\r\n      });\r\n\r\n      btn.click(function(e) {\r\n        e.preventDefault();\r\n        var buttonhref= $(this).data('href');\r\n\r\n        //f its not a reattempt ... proceed\r\n        if($(this).data('action')!=='reattempt') {\r\n            window.location.href = buttonhref;\r\n            return;\r\n        }\r\n\r\n        //if its a reattempt, confirm and proceed\r\n          ModalFactory.create({\r\n              type: ModalFactory.types.SAVE_CANCEL,\r\n              title: that.strings.reattempttitle,\r\n              body: that.strings.reattemptbody\r\n          })\r\n          .then(function(modal) {\r\n              modal.setSaveButtonText(that.strings.reattempt);\r\n              var root = modal.getRoot();\r\n              root.on(ModalEvents.save, function() {\r\n                  window.location.href = buttonhref;\r\n              });\r\n              modal.show();\r\n          });\r\n\r\n      });\r\n\r\n    },\r\n\r\n    init_strings: function(){\r\n        var that = this;\r\n        // set up strings\r\n        str.get_strings([\r\n            {\"key\": \"reattempttitle\",       \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattemptbody\",           \"component\": 'mod_wordcards'},\r\n            {\"key\": \"reattempt\",           \"component\": 'mod_wordcards'}\r\n\r\n        ]).done(function(s) {\r\n            var i = 0;\r\n            that.strings.reattempttitle = s[i++];\r\n            that.strings.reattemptbody = s[i++];\r\n            that.strings.reattempt = s[i++];\r\n        });\r\n    }\r\n\r\n  }\r\n\r\n});\r\n"],"names":["define","$","Ajax","Notification","ModalFactory","str","ModalEvents","a4e","strings","init","opts","that","this","init_strings","theid","propscontrol","get","props","JSON","parse","value","remove","totalcards","length","addClass","set_progress_info","click","cr_index","index","removeClass","setTimeout","css","curr_level_card","html","parseInt","container","btn","modid","canmanage","canattempt","find","register_events","init_audio","token","region","owner","on","e","preventDefault","termNode","parents","first","termId","data","call","then","result","Deferred","reject","fail","exception","always","buttonhref","create","type","types","SAVE_CANCEL","title","reattempttitle","body","reattemptbody","modal","setSaveButtonText","reattempt","getRoot","save","window","location","href","show","log","debug","total","text","get_strings","done","s","i"],"mappings":"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"}