{"version":3,"file":"mywords.min.js","sources":["../src/mywords.js"],"sourcesContent":["/**\n * Module to watch my words buttons for clicks and report to back end.\n *\n * @package mod_wordcards\n * @author David Watson - evolutioncode.uk\n */\ndefine(['jquery', 'core/ajax', 'core/str'], function($, ajax, str) {\n    const SELECTOR = {\n        DATA_SET: '*[data-action=\"wordcards-set-my-words\"]',\n        MY_WORDS_DIV: '#my-words-ids',\n        MY_WORDS_ACTION_BTN_ID: '.wordcards-mywords-action-',\n        WORDPOOL_COUNTS: '.wordpool-count'\n    }\n\n    const CLASS = {\n        DISABLED: 'disabled',\n        BTN_NOT_IN_MY_WORDS: 'btn-outline-primary',\n        BTN_IN_MY_WORDS: 'btn-primary'\n    }\n\n    const EVENT = {\n        CLICK: 'click'\n    }\n\n    const DATA = {\n        TERM_ID: 'data-termid',\n        VALUE: 'data-value',\n        ADD: 'data-add',\n        REMOVE: 'data-remove',\n        MY_WORDS_IDS: 'data-my-words-term-ids'\n    }\n    var stringStore = {};\n\n    const initStrings = function (callback) {\n        str.get_strings([\n            {key: \"addtomywords\", component: \"mod_wordcards\"},\n            {key: \"removefrommywords\", component: \"mod_wordcards\"},\n        ]).done(function (strings) {\n            stringStore = strings;\n            if (typeof callback == 'function') {\n                callback();\n            }\n        });\n    }\n\n    const initButtonListeners = function() {\n        $(SELECTOR.DATA_SET).on(EVENT.CLICK, function(e) {\n            e.stopPropagation();\n            // There are two buttons for each term (one in grid and one in flashcards).\n            const currTar = $(e.currentTarget);\n            const buttons = $(SELECTOR.MY_WORDS_ACTION_BTN_ID + currTar.attr(DATA.TERM_ID));\n            const termId = buttons.attr(DATA.TERM_ID);\n            if (!currTar.hasClass(CLASS.DISABLED)) {\n                e.preventDefault();\n                buttons.addClass(CLASS.DISABLED)\n                // Hide wordpool counts in drop down as may become incorrect here.\n                $(SELECTOR.WORDPOOL_COUNTS).fadeOut();\n                const newStatus = buttons.hasClass(CLASS.BTN_IN_MY_WORDS) ? 0 : 1;\n                ajax.call([{\n                    methodname: 'mod_wordcards_set_my_words',\n                    args: {\n                        termid: termId,\n                        newstatus: newStatus\n                    }\n                }])[0].done(function(response) {\n                    if (response.success) {\n                        buttons.removeClass(CLASS.DISABLED);\n                        if (response.newStatus) {\n                            buttons.addClass(CLASS.BTN_IN_MY_WORDS);\n                            buttons.removeClass(CLASS.BTN_NOT_IN_MY_WORDS);\n                            buttons.attr('title', stringStore[1]);\n                        } else {\n                            buttons.removeClass(CLASS.BTN_IN_MY_WORDS);\n                            buttons.addClass(CLASS.BTN_NOT_IN_MY_WORDS);\n                            buttons.attr('title', stringStore[0]);\n                        }\n                    }\n                }).fail(function() {\n                    buttons.removeClass(CLASS.DISABLED);\n                })\n            }\n        })\n    }\n\n    /**\n     * Existing button statuses are on the main freemode template markup, so we need to grab them and render them,\n     */\n    const applyButtonStatuses = function() {\n        const myWordsDiv = $(SELECTOR.MY_WORDS_DIV);\n        if (myWordsDiv) {\n            const ids = JSON.parse(myWordsDiv.attr(DATA.MY_WORDS_IDS));\n            ids.forEach((id) => {\n                const btn = $(SELECTOR.MY_WORDS_ACTION_BTN_ID + id);\n                if (!btn.hasClass(CLASS.BTN_IN_MY_WORDS)) {\n                    btn\n                        .addClass(CLASS.BTN_IN_MY_WORDS)\n                        .removeClass(CLASS.BTN_NOT_IN_MY_WORDS)\n                        .attr('title', stringStore[1]);\n                }\n            });\n            return true;\n        }\n    }\n    return {\n        init: function () {\n            $(document).ready(function() {\n                initStrings();\n                initButtonListeners();\n            })\n        },\n        initFromFeedbackPage: function () {\n            initStrings(applyButtonStatuses);\n            initButtonListeners();\n        }\n    }\n});"],"names":["define","$","ajax","str","SELECTOR","CLASS","EVENT","DATA","stringStore","initStrings","callback","get_strings","key","component","done","strings","initButtonListeners","on","e","stopPropagation","currTar","currentTarget","buttons","attr","termId","hasClass","preventDefault","addClass","fadeOut","newStatus","call","methodname","args","termid","newstatus","response","success","removeClass","fail","applyButtonStatuses","myWordsDiv","JSON","parse","forEach","id","btn","init","document","ready","initFromFeedbackPage"],"mappings":"AAMAA,+BAAO,CAAC,SAAU,YAAa,aAAa,SAASC,EAAGC,KAAMC,WACpDC,kBACQ,0CADRA,sBAEY,gBAFZA,gCAGsB,6BAHtBA,yBAIe,kBAGfC,eACQ,WADRA,0BAEmB,sBAFnBA,sBAGe,cAGfC,YACK,QAGLC,aACO,cADPA,kBAKY,6BAEdC,YAAc,SAEZC,YAAc,SAAUC,UAC1BP,IAAIQ,YAAY,CACZ,CAACC,IAAK,eAAgBC,UAAW,iBACjC,CAACD,IAAK,oBAAqBC,UAAW,mBACvCC,MAAK,SAAUC,SACdP,YAAcO,QACS,mBAAZL,UACPA,eAKNM,oBAAsB,WACxBf,EAAEG,mBAAmBa,GAAGX,aAAa,SAASY,GAC1CA,EAAEC,wBAEIC,QAAUnB,EAAEiB,EAAEG,eACdC,QAAUrB,EAAEG,gCAAkCgB,QAAQG,KAAKhB,eAC3DiB,OAASF,QAAQC,KAAKhB,kBACvBa,QAAQK,SAASpB,gBAAiB,CACnCa,EAAEQ,iBACFJ,QAAQK,SAAStB,gBAEjBJ,EAAEG,0BAA0BwB,gBACtBC,UAAYP,QAAQG,SAASpB,uBAAyB,EAAI,EAChEH,KAAK4B,KAAK,CAAC,CACPC,WAAY,6BACZC,KAAM,CACFC,OAAQT,OACRU,UAAWL,cAEf,GAAGf,MAAK,SAASqB,UACbA,SAASC,UACTd,QAAQe,YAAYhC,gBAChB8B,SAASN,WACTP,QAAQK,SAAStB,uBACjBiB,QAAQe,YAAYhC,2BACpBiB,QAAQC,KAAK,QAASf,YAAY,MAElCc,QAAQe,YAAYhC,uBACpBiB,QAAQK,SAAStB,2BACjBiB,QAAQC,KAAK,QAASf,YAAY,SAG3C8B,MAAK,WACJhB,QAAQe,YAAYhC,wBAS9BkC,oBAAsB,iBAClBC,WAAavC,EAAEG,0BACjBoC,WAAY,QACAC,KAAKC,MAAMF,WAAWjB,KAAKhB,oBACnCoC,SAASC,WACHC,IAAM5C,EAAEG,gCAAkCwC,IAC3CC,IAAIpB,SAASpB,wBACdwC,IACKlB,SAAStB,uBACTgC,YAAYhC,2BACZkB,KAAK,QAASf,YAAY,QAGhC,UAGR,CACHsC,KAAM,WACF7C,EAAE8C,UAAUC,OAAM,WACdvC,cACAO,0BAGRiC,qBAAsB,WAClBxC,YAAY8B,qBACZvB"}